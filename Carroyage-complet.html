<!DOCTYPE html>
<html>
<head>
  <title>Générateur de carroyage CADO</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    label {
      display: block;
      margin-bottom: 5px;
    }
    input {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>Générateur de carroyage CADO</h1>
  
  <label for="coordinates">Coordonnées (WGS84, format "google", par exemple : <i>48.803322, 2.126005</i>):</label>
  <input type="text" id="coordinates" placeholder="Entrer les Coordonnées">
  
  <label for="length">Échelle (en mêtres):</label>
  <input type="number" id="length" placeholder="Spécifier l'échelle">
  <label for="color">Choisir une couleur :</label>
  <select id="color">
    <option value="BFFFFFFF">Blanc</option>
    <option value="BF000000">Noir</option>
    <option value="BFBEBEBE">Gris</option>
    <option value="BF1478F0">Orange</option>
  </select>
  
  
  
  <button onclick="generateGridKML()">Télécharger le KML du carroyage</button>
  <button onclick="generatePointsKML()">Télécharger le KML des points</button>
  
  <script>
    function generateGridKML() {
      var coordinates = document.getElementById("coordinates").value;
      var latLngArray = coordinates.split(',');
      var latitude = parseFloat(latLngArray[0].trim());
      var longitude = parseFloat(latLngArray[1].trim());

      var length = parseFloat(document.getElementById("length").value);
	  var color = document.getElementById("color").value;
      var metersPerDegreeLat = 111320; // Approximate meters per degree latitude
      var halfGridSize = Math.floor(26 / 2); // Half of the grid size

      var startingLat = latitude - (halfGridSize * (length / metersPerDegreeLat));
      var startingLon = longitude - (halfGridSize * (length / (metersPerDegreeLat * Math.cos(latitude * (Math.PI / 180)))));

      var kmlContent = `<?xml version="1.0" encoding="UTF-8"?>
                        <kml xmlns="http://www.opengis.net/kml/2.2">
                          <Document>
                            <Style id="gridLineStyle">
                              <LineStyle>
                                <color>${color}</color>
                                <width>2</width>
                              </LineStyle>
                            </Style>`;

      for (var i = 0; i < 26; i++) {
        var row = String.fromCharCode(65 + i); // Convert ASCII code to letter (A-Z)

        for (var j = 0; j < 26; j++) {
          var line = j + 1;
          var lat = startingLat + (i * (length / metersPerDegreeLat));
          var lon = startingLon + (j * (length / (metersPerDegreeLat * Math.cos(lat * (Math.PI / 180)))));

          kmlContent += `  <Placemark>
                            <name>${row}${line}</name>
                            <Style>
								<LineStyle>
									<color>${color}</color>
									<width>2</width>
								</LineStyle>
							</Style>
                            <LineString>
                              <coordinates>${lon},${lat} ${lon + (length / (metersPerDegreeLat * Math.cos(lat * (Math.PI / 180))))},${lat} ${lon + (length / (metersPerDegreeLat * Math.cos(lat * (Math.PI / 180))))},${lat + (length / metersPerDegreeLat)} ${lon},${lat + (length / metersPerDegreeLat)} ${lon},${lat}</coordinates>
                            </LineString>
                          </Placemark>`;
        }
      }

      kmlContent += `</Document>
                    </kml>`;

      var element = document.createElement('a');
      element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(kmlContent));
      element.setAttribute('download', 'carroyage.kml');
      element.style.display = 'none';
      document.body.appendChild(element);
      element.click();
      document.body.removeChild(element);
    }
	 function generatePointsKML() {
      var coordinates = document.getElementById("coordinates").value;
      var latLngArray = coordinates.split(',');
      var latitude = parseFloat(latLngArray[0].trim());
      var longitude = parseFloat(latLngArray[1].trim());

      var length = parseFloat(document.getElementById("length").value);
      var color = document.getElementById("color").value;
      var metersPerDegreeLat = 111320; // Approximate meters per degree latitude

      var halfLength = length / 2;
      var halfGridSize = Math.floor(26 / 2); // Half of the grid size

      var startingLat = latitude - (halfGridSize * (length / metersPerDegreeLat)) + (halfLength / metersPerDegreeLat);
      var startingLon = longitude - (halfGridSize * (length / (metersPerDegreeLat * Math.cos(latitude * (Math.PI / 180))))) + (halfLength / (metersPerDegreeLat * Math.cos(latitude * (Math.PI / 180))));

      var kmlContent = `<?xml version="1.0" encoding="UTF-8"?>
                        <kml xmlns="http://www.opengis.net/kml/2.2">
                          <Document>
							<Style id="cado">
								<LineStyle>
									<color>${color}</color>
									<width>2</width>
								</LineStyle>
								<LabelStyle>
									<scale>1</scale>
								</LabelStyle>
								<IconStyle>
									<scale>0.1</scale>
									<h>0</h>
									<w>0</w>
									<Icon>
										<href>https://upload.wikimedia.org/wikipedia/commons/8/8c/Transparent.png</href>
									</Icon>
									<hotSpot x="0.5"  y="0.5" xunits="fraction" yunits="fraction"/>
								</IconStyle>
                            </Style>`;

      for (var i = 0; i < 26; i++) {
	var row = String.fromCharCode(65 + i); // Convert ASCII code to letter (A-Z)      
        

        for (var j = 0; j < 26; j++) {
          var line = j + 1; // Numbered line (1-26)
          var lat = startingLat + (j * (length / metersPerDegreeLat));
          var lon = startingLon + (i * (length / (metersPerDegreeLat * Math.cos(lat * (Math.PI / 180)))));

          kmlContent += `  <Placemark>
                            <name>${row}${line}</name>
							<styleUrl>#cado</styleUrl>
                            <Point>
							    <coordinates>${lon},${lat}</coordinates>
                            </Point>
                          </Placemark>`;
        }
      }

      kmlContent += `</Document>
                    </kml>`;

      var element = document.createElement('a');
      element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(kmlContent));
      element.setAttribute('download', 'points.kml');
      element.style.display = 'none';
      document.body.appendChild(element);
      element.click();
      document.body.removeChild(element);
    }
  </script>
</body>
</html>
